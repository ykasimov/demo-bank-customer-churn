schema: '2.0'
stages:
  data_split:
    cmd: python stages/data_split.py --config=params.yaml
    deps:
    - path: data/Churn_Modelling_0.csv
      md5: 201b3eb1d8d81aa6286466385528b3e2
      size: 342639
    - path: stages/data_split.py
      md5: 519fbe22a8ce712999f28010f3c56fe6
      size: 1606
    params:
      params.yaml:
        base:
          project: bank_customer_churn
          data_dir: data
          data_fname: Churn_Modelling_0.csv
          cat_cols:
          - Geography
          num_cols:
          - CreditScore
          - Age
          - Tenure
          - Balance
          - NumOfProducts
          - HasCrCard
          - IsActiveMember
          - EstimatedSalary
          targ_col: Exited
          random_state: 42
          model_dir: model/
          model_file: clf-model
        data_split:
          test_size: 0.25
    outs:
    - path: data/X_test.pkl
      md5: fd3007d1a7bdff44ff89571ebedd519e
      size: 93528
    - path: data/X_train.pkl
      md5: 56146d7dde8707b66619ce99e7cfcc20
      size: 278467
    - path: data/y_test.pkl
      md5: 745eb9da6d360516befe492af2787d41
      size: 30613
    - path: data/y_train.pkl
      md5: dbb125a59205f428a0b3e535efdfe83d
      size: 90598
  train:
    cmd: python stages/train.py --config=params.yaml
    deps:
    - path: data/X_train.pkl
      md5: 56146d7dde8707b66619ce99e7cfcc20
      size: 278467
    - path: data/y_train.pkl
      md5: dbb125a59205f428a0b3e535efdfe83d
      size: 90598
    - path: stages/train.py
      md5: 67644e02d26811ad6690245d4a11adfc
      size: 3321
    params:
      params.yaml:
        base:
          project: bank_customer_churn
          data_dir: data
          data_fname: Churn_Modelling_0.csv
          cat_cols:
          - Geography
          num_cols:
          - CreditScore
          - Age
          - Tenure
          - Balance
          - NumOfProducts
          - HasCrCard
          - IsActiveMember
          - EstimatedSalary
          targ_col: Exited
          random_state: 42
          model_dir: model/
          model_file: clf-model
        train:
          model_type: randomforest
          update_model: anavo-model
          update_model_stage: prod
          params:
            n_estimators: 45
            max_depth: 5
            warm_start: true
    outs:
    - path: model//clf-model
      md5: 8067aa5cb8dff89825991f31e8c50d47
      size: 183880
    - path: model//clf-model.mlem
      md5: 37f014fec52930732ac3a6ee38bf2e54
      size: 1706
  compare:
    cmd: python stages/compare.py --config=params.yaml
    deps:
    - path: data/X_test.pkl
      md5: fd3007d1a7bdff44ff89571ebedd519e
      size: 93528
    - path: data/y_test.pkl
      md5: 745eb9da6d360516befe492af2787d41
      size: 30613
    - path: model/clf-model
      md5: 8067aa5cb8dff89825991f31e8c50d47
      size: 183880
    - path: stages/compare.py
      md5: 8808ec1a9b6b3ab329bcd5079b1f889c
      size: 1201
    params:
      params.yaml:
        base:
          project: bank_customer_churn
          data_dir: data
          data_fname: Churn_Modelling_0.csv
          cat_cols:
          - Geography
          num_cols:
          - CreditScore
          - Age
          - Tenure
          - Balance
          - NumOfProducts
          - HasCrCard
          - IsActiveMember
          - EstimatedSalary
          targ_col: Exited
          random_state: 42
          model_dir: model/
          model_file: clf-model
    outs:
    - path: comparison_metrics.json
      md5: 7f068baaf359d91a873052b2412e8cdf
      size: 95
  eval:
    cmd: python stages/eval.py --config=params.yaml
    deps:
    - path: data/X_test.pkl
      md5: fd3007d1a7bdff44ff89571ebedd519e
      size: 93528
    - path: data/y_test.pkl
      md5: 745eb9da6d360516befe492af2787d41
      size: 30613
    - path: model//clf-model
      md5: 8067aa5cb8dff89825991f31e8c50d47
      size: 183880
    - path: model//clf-model.mlem
      md5: 37f014fec52930732ac3a6ee38bf2e54
      size: 1706
    - path: stages/eval.py
      md5: 0f8bd41fc66ef9117d6e3451a3ed3631
      size: 2700
    params:
      params.yaml:
        base:
          project: bank_customer_churn
          data_dir: data
          data_fname: Churn_Modelling_0.csv
          cat_cols:
          - Geography
          num_cols:
          - CreditScore
          - Age
          - Tenure
          - Balance
          - NumOfProducts
          - HasCrCard
          - IsActiveMember
          - EstimatedSalary
          targ_col: Exited
          random_state: 42
          model_dir: model/
          model_file: clf-model
        data_split:
          test_size: 0.25
        train:
          model_type: randomforest
          update_model: anavo-model
          update_model_stage: prod
          params:
            n_estimators: 45
            max_depth: 5
            warm_start: true
    outs:
    - path: eval_plots/cm.png
      md5: 55cc33f6631a0e1dab5edf072633dbf3
      size: 10604
    - path: eval_plots/plots/sklearn/roc.json
      md5: 266b3a4e8edd52b0ec1bd639b7f65772
      size: 45660
    - path: feat_imp.csv
      md5: 6c5315147f6ddba952a32b186d608e7b
      size: 284
    - path: metrics.json
      md5: 0fb819bbc70099f2af6749a8ba1b57ff
      size: 65
    - path: models/perm_imp.joblib
      md5: a6bb8ff5a5870717a6e5333d72cd3805
      size: 185131
